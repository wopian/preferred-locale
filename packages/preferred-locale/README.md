<h1 align=center>Preferred Locale</h1>

<p align=center>
  <a href=https://www.npmjs.com/package/preferred-locale><img alt=npm src=https://flat.badgen.net/npm/v/preferred-locale></a>
  <a href=https://www.npmjs.com/package/preferred-locale><img alt=npm src=https://flat.badgen.net/npm/dt/preferred-locale></a>
  <a href="https://david-dm.org/wopian/preferred-locale?path=packages/preferred-locale"><img alt=deps src=https://flat.badgen.net/david/dep/wopian/preferred-locale/packages/preferred-locale></a>
  <a href="https://bundlephobia.com/result?p=preferred-locale"><img alt=bundlephobia src="https://flat.badgen.net/bundlephobia/minzip/preferred-locale?label=library%20size"></a>
  <a href="https://packagephobia.now.sh/result?p=preferred-locale"><img alt=packagephobia src="https://flat.badgen.net/packagephobia/install/preferred-locale?label=node_modules"></a>
</p>

<p align=center>
  <a href="https://github.com/wopian/preferred-locale/actions"><img alt=checks src="https://flat.badgen.net/github/checks/wopian/preferred-locale"></a>
  <a href=https://github.com/wopian/preferred-locale/network/dependents><img alt=repoDependants src=https://flat.badgen.net/github/dependents-repo/wopian/preferred-locale></a>
  <a href=https://github.com/wopian/preferred-locale/graphs/contributors><img alt=devDeps src=https://flat.badgen.net/github/contributors/wopian/preferred-locale></a>
  <a href=https://github.com/sponsors/wopian><img alt=sponsor src='https://flat.badgen.net/badge/sponsor/%E2%9D%A4/pink?icon=github'></a>
</p>

<p align=center>ðŸŽŒ Get the users' most preferred locale/language from your app's available translations with zero dependencies</p>

## Features

-   Uses the Intl.Locale API (backwards compatible)
-   Works on node & browsers
-   Zero dependencies

## Guaranteed Node / Browser Support

|            Package | Package<br>Size | Node | Chrome | Firefox | Safari | Edge |
| -----------------: | :-------------: | :--: | :----: | :-----: | :----: | :--: |
| `preferred-locale` |    ~600 bytes   |  10+ |   69+  |   68+   |   12+  |  18+ |

## Why?

Many web applications that automatically detect the browser language and serve the relevent translation are fundamentally broken.

A browser that signals the user prefers the following locales (index `0` being most preferred) should _never_ return content in Japanese (`ja-JP`) if the application has translations for Japanese and American English (`en-US`):

-   `[ 'en-GB', 'en', 'ja-JP', 'en-US', 'ja' ]`

Instead, many applications (e.g Epic Games' store, help and documentation) will instead serve their users content in Japanese as they do not provide translations for British English, only American English and only check for exact matches.

`preferred-locale` fixes this by traversing the supported node/browser languages in order of priority:

1.  If an exact match is found it uses that (e.g `en-GB` is translated).
2.  If the node/browser language is supported but the region is not (e.g Australian English), the canonical region is looked up and tested against (e.g `en-AU` becomes `en-US`),
3.  If only a language is provided (e.g `en`), the canonical region is looked up and tested against (e.g `en` becomes `en-US`)
4.  If no node/browser locale resolves to a translated locale, the fallback locale is returned

### Live Demo

A step-by-step demonstration of how `preferred-locale` works with your own browser locales is available at [eehz9.csb.app](https://eehz9.csb.app).

### Example Step-By-Step

Application has translations for `en-US` and `ja-JP`

1.  Raw browser locales `[ 'en-GB', 'en', 'ja-JP', 'en-US', 'ja' ]`

2.  Unify the browser locales `[ 'en-GB', 'en-US', 'ja-JP', 'en-US', 'ja-JP' ]`

3.  Deduplicate the locales `[ 'en-GB', 'en-US', 'ja-JP' ]`

4.  Remove locales not translated `[ 'en-US', 'ja-JP' ]`

5.  User gets content in `en-US`

## Install

### Yarn / NPM

```bash
yarn add preferred-locale
npm install preferred-locale
```

```js
import preferredLocale from 'preferred-locale'      // ES Modules and Babel
const preferredLocale = require('preferred-locale') // CommonJS and Browserify

const translatedLocales = [ 'en-us', 'en-gb', 'fr-fr' ]
const fallback = 'en-us'
preferredLocale(translatedLocales, fallback, { lowerCaseRegion: true })
// Returns 'en-gb' if browser/node user language is [ 'en-gb', 'nl-nl' ]
```

### CDNs

```html
<!-- jsDelivr -->
<script src='https://cdn.jsdelivr.net/npm/preferred-locale'></script>

<!-- unpkg -->
<script src='https://unpkg.com/preferred-locale'></script>
```

```js
const translatedLocales = [ 'en-US', 'en-GB', 'fr-FR' ]
const fallback = 'en-US'
preferredLocale(translatedLocales, fallback)
// Returns 'en-GB' if browser/node user language is [ 'en-GB', 'fr-FR' ]
```

## API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

#### Table of Contents

-   [preferredLocale](#preferredlocale)
    -   [Parameters](#parameters)

### preferredLocale

[packages/preferred-locale/src/index.js:14-22](https://github.com/wopian/preferred-locale/blob/a53774a9218b5f11519162edcd0245c4b8149cd3/packages/preferred-locale/src/index.js#L14-L22 "Source code on GitHub")

Get the users' most preferred locale that is translated by your application.

#### Parameters

-   `translatedLocales` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>** Translations provided by the application
-   `fallback` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Source locale of the application. Used when no browser locale matches translatedLocales
-   `options` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** Configuration options (optional, default `{}`)
    -   `options.regionLowerCase` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** If true, returns `en-us` instead of `en-US` (optional, default `false`)
    -   `options.languageOnly` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** If true, returns `en` instead of `en-US` or `en-us` (optional, default `false`)

Returns **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Preferred locale
